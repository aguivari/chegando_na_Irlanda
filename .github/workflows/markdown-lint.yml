name: Lint Markdown Files

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ "**" ]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3.3.0

    - name: Set up Node.js
      uses: actions/setup-node@v3.6.0
      with:
        node-version: 16

    - name: Install dependencies
      run: npm install markdownlint-cli --save-dev

    - name: Lint markdown files
      continue-on-error: true
      run: |
        npx markdownlint --ignore node_modules --disable MD013 -- '**/*.md' > markdownlint_result.json
        if [ -s markdownlint_result.json ]; then 
          echo "Linting failed."
          exit 1
        fi

    - name: Comment on pull request
      if: github.event_name == 'pull_request'
      uses: thollander/actions-comment-pull-request@v2.3.1
      with:
        msg: |
          ## Markdown Lint Results
          The linting results are available in the artifact [markdownlint_result.json](${{ steps.lint.outputs.artifact_url }}).
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
