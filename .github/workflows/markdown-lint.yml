name: Lint Markdown Files

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ "**" ]

jobs:
  lint:
    runs-on: ubuntu-latest
    permissions: 
      pull-requests: write 

    steps:
    - name: Checkout code
      uses: actions/checkout@v3.3.0

    - name: Set up Node.js
      uses: actions/setup-node@v3.6.0
      with:
        node-version: 16

    - name: Install dependencies
      run: npm install markdownlint-cli --save-dev

    - name: Lint markdown files
      run: |
        npx markdownlint --ignore node_modules --disable MD013 -- '**/*.md' 2> markdownlint_errors.txt
        if [ -s markdownlint_errors.txt ]; then exit 1; fi

    - name: Comment on pull request
      if: failure()
      uses: thollander/actions-comment-pull-request@v2.3.1
      with:
        body: "Lint errors found in the following files:\n```\n$(cat markdownlint_errors.txt)\n```"
        github_token: ${{ secrets.GITHUB_TOKEN }}
