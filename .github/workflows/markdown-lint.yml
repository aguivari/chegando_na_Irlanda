name: Lint Markdown Files

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ "**" ]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3.3.0

    - name: Set up Node.js
      uses: actions/setup-node@v3.6.0
      with:
        node-version: 16

    - name: Install dependencies
      run: npm install markdownlint-cli --save-dev

    - name: Lint markdown files
      continue-on-error: true
      run: |
        npx markdownlint --ignore node_modules --disable MD013 -- '**/*.md'

    - name: Comment on pull request
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v6.4.0
      with:
        script: |
          const lintErrors = context.run.stderr || '';
          const pullRequestNumber = github.event.number;
          const commentBody = `
          ## Lint Errors
          ${lintErrors}
          `;
          const response = await github.pulls.createReview({
            owner: github.repository.owner.login,
            repo: github.repository.name,
            pull_number: pullRequestNumber,
            body: commentBody,
            event: "COMMENT"
          });
          console.log(response.data);
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
