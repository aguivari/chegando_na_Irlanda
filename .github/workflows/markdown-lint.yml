name: Lint Markdown Files

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ "**" ]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Node.js 16
      uses: actions/setup-node@v2
      with:
        node-version: 16

    - name: Install dependencies
      run: npm ci

    - name: Lint markdown files
      run: |
        npx markdownlint --config .markdownlint.json "**/*.md"
        if [ $? -ne 0 ]; then
          echo "::error::Markdown linting failed"
          exit 1
        fi

    - name: Report linting results
      id: results
      uses: actions/upload-artifact@v2
      with:
        name: lint-report.json
        path: markdownlint_result.json

    - name: Comment on pull request
      if: github.event_name == 'pull_request'
      uses: peter-evans/create-or-update-pull-request-comment@v3
      with:
        message: |
          ## Markdown Lint Results
          ${{ steps.results.outputs.artifact_url }}
          ## Lint Errors
          ${{ steps.lint.outputs.stderr }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
